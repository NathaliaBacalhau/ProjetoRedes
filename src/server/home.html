<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>File Cloud</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				background-color: #ffffff;
				margin: 0;
				padding: 0;
			}

			h1 {
				color: rgb(0, 0, 0);
			}

			.dropzone {
				display: grid;
				margin-left: 10%;
				padding: 10px;
				width: 80%;
				border: 4px solid;
				border-radius: 5px;
				border-color: rgb(0, 0, 0);
				
			}
		</style>
	</head>

	<body>
		<h1>File Cloud</h1>

		<div id="files" class="dropzone" ondragover="allowDrop(event)" ondrop="dropHandler(event)">
		</div>

		<script>
			function allowDrop(event) {
				event.preventDefault();
				const dropzone = document.getElementById('files');
				if (dropzone) {
					dropzone.classList.add('active');
				}
			}

			function dropHandler(event) {
				event.preventDefault();
				const dropzone = document.getElementById('files');
				if (dropzone) {
					dropzone.classList.remove('active');
				}
				const files = event.dataTransfer.files;
				for (const file of files) {
					const reader = new FileReader();
					reader.onload = function (e) {
						const content = e.target.result;
						createFile(file.name, content);
					};
					reader.readAsText(file);
				}
				getAll();
			}

			const stack = ["$root$"];

			function path() {
				return stack.join('\\');
			}

			// Função para criar um novo arquivo
			function createFile(name, data) {
				fetch(`/create/${path()}`, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({ name: name, data: data }),
				});
			}

			// Função para ver arquivos existentes
			function getFile() {
				const nome = document.getElementById('nomeBuscar').value;
				if (!nome) {
					alert('Preencha os campo de busca');
					return;
				}
				stack.push(nome);
				fetch(`/get/${path()}`, {
					method: 'GET'
				}).then(response => {
					return response.text();
				}).then(data => {
					document.getElementById('textoGet').value = data;
					stack.pop();
				});
			}

			// Função para excluir um arquivo existente
			function deleteFile() {
				const nome = document.getElementById('nomeDeletar').value;
				if (!nome) {
					alert('Preencha o campo de deleção');
					return;
				}
				stack.push(nome);
				fetch(`/delete/${path()}`, {
					method: 'DELETE'
				}).then(response => response.statusText).then(message => {
					alert(`Arquivo "${nome}" deletado.`);
					stack.pop();
				});
			}

			function getAll() {
				fetch(`/getAll/${path()}`, {
					method: 'GET'
				}).then(response => response.text()).then(files => {
					const fileList = files.substring(1, files.length - 1).split(',').map(file => file.trim());
					for (const file of fileList) {
						const link = document.createElement('a');
						link.href = `/get/${path()}/${file}`;
						link.innerText = file;
						document.getElementById('files').appendChild(link);
					}
				});
			}

			getAll();
		</script>
	</body>

</html>